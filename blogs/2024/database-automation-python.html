<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Building Database Automation with Python - Nipuna Perera</title>
    <meta name="description" content="Exploring Python-based automation strategies for database operations, including monitoring, backup management, and performance optimization scripts.">
    <link rel="stylesheet" href="../../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .blog-content {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .blog-content h1 {
            color: var(--terminal-green-bright);
            font-size: 2rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid var(--terminal-green-dim);
            padding-bottom: 0.5rem;
        }
        
        .blog-content h2 {
            color: var(--terminal-cyan);
            font-size: 1.5rem;
            margin: 2rem 0 1rem 0;
        }
        
        .blog-content h3 {
            color: var(--terminal-yellow);
            font-size: 1.25rem;
            margin: 1.5rem 0 0.5rem 0;
        }
        
        .blog-content p {
            margin-bottom: 1rem;
            color: var(--terminal-green);
        }
        
        .blog-content code {
            background: rgba(0, 255, 0, 0.1);
            color: var(--terminal-green-bright);
            padding: 2px 4px;
            border-radius: 3px;
            font-family: var(--font-mono);
        }
        
        .blog-content pre {
            background: #f8fafc;
            border: 1px solid #e5e7eb;
            border-radius: 5px;
            padding: 15px;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .blog-content pre code {
            background: none;
            padding: 0;
            color: var(--terminal-green);
        }
        
        .blog-content ul, .blog-content ol {
            margin: 1rem 0;
            padding-left: 2rem;
        }
        
        .blog-content li {
            margin-bottom: 0.5rem;
            color: var(--terminal-green);
        }
        
        .blog-content blockquote {
            border-left: 4px solid var(--terminal-green-dim);
            padding-left: 1rem;
            margin: 1rem 0;
            color: var(--terminal-white);
            font-style: italic;
        }
        
        .blog-content a {
            color: var(--terminal-cyan);
            text-decoration: none;
        }
        
        .blog-content a:hover {
            color: var(--terminal-white);
            text-shadow: 0 0 5px var(--terminal-cyan);
        }
        
        .blog-meta {
            background: rgba(17, 24, 39, 0.03);
            border: 1px solid var(--terminal-green-dim);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 2rem;
        }
        
        .blog-meta .meta-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .blog-meta .meta-label {
            color: var(--terminal-cyan);
            font-weight: 500;
        }
        
        .blog-meta .meta-value {
            color: var(--terminal-green-bright);
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 2rem;
            color: var(--terminal-cyan);
            text-decoration: none;
            font-weight: 500;
        }
        
        .back-link:hover {
            color: var(--terminal-white);
            text-shadow: 0 0 5px var(--terminal-cyan);
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div class="terminal-header">
            <div class="terminal-buttons">
                <span class="btn-close"></span>
                <span class="btn-minimize"></span>
                <span class="btn-maximize"></span>
            </div>
            <div class="terminal-title">nipuna@localhost:~/blogs/2024$</div>
        </div>
        
        <div class="terminal-body">
            <div class="terminal-content">
                <div class="command-line">
                    <span class="prompt">nipuna@localhost:~/blogs/2024$</span>
                    <span class="command">cat database-automation-python.md</span>
                </div>
                <div class="output">
                    <div class="blog-content">
                        <a href="../../blog.html" class="back-link">
                            <i class="fas fa-arrow-left"></i> Back to blog
                        </a>
                        
                        <div class="blog-meta">
                            <div class="meta-item">
                                <span class="meta-label">Title:</span>
                                <span class="meta-value">Building Database Automation with Python: A Practical Approach</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Author:</span>
                                <span class="meta-value">Nipuna Perera</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Date:</span>
                                <span class="meta-value">December 5, 2024</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Category:</span>
                                <span class="meta-value">Automation</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Read Time:</span>
                                <span class="meta-value">15 min read</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Tags:</span>
                                <span class="meta-value">Python, MySQL, Redis, Automation, Monitoring</span>
                            </div>
                        </div>
                        
                        <h1>Building Database Automation with Python: A Practical Approach</h1>
                        
                        <h2>Introduction</h2>
                        <p>Database automation is crucial for maintaining reliable, scalable systems. This post explores practical Python-based automation strategies I've developed and used in production environments.</p>
                        
                        <h2>Core Automation Areas</h2>
                        
                        <h3>1. Database Monitoring</h3>
                        
                        <h4>Health Checks</h4>
                        
                        <pre><code>import mysql.connector
import redis
import psycopg2
from datetime import datetime
import logging

class DatabaseHealthChecker:
    def __init__(self, config):
        self.config = config
        self.logger = logging.getLogger(__name__)
    
    def check_mysql_health(self, host, port, user, password, database):
        try:
            conn = mysql.connector.connect(
                host=host,
                port=port,
                user=user,
                password=password,
                database=database,
                connect_timeout=5
            )
            
            cursor = conn.cursor()
            cursor.execute("SELECT 1")
            result = cursor.fetchone()
            
            # Check replication lag
            cursor.execute("SHOW SLAVE STATUS")
            slave_status = cursor.fetchone()
            
            if slave_status and slave_status[32]:  # Seconds_Behind_Master
                lag = slave_status[32]
                if lag > 60:  # More than 1 minute lag
                    self.logger.warning(f"High replication lag: {lag} seconds")
            
            cursor.close()
            conn.close()
            
            return {
                'status': 'healthy',
                'timestamp': datetime.now().isoformat(),
                'replication_lag': lag if 'lag' in locals() else 0
            }
            
        except Exception as e:
            self.logger.error(f"MySQL health check failed: {e}")
            return {
                'status': 'unhealthy',
                'error': str(e),
                'timestamp': datetime.now().isoformat()
            }</code></pre>
                        
                        <h3>2. Automated Backups</h3>
                        
                        <h4>MySQL Backup Script</h4>
                        
                        <pre><code>import subprocess
import boto3
from datetime import datetime, timedelta
import os
import gzip

class MySQLBackupManager:
    def __init__(self, config):
        self.config = config
        self.s3_client = boto3.client('s3')
    
    def create_backup(self, database, output_dir):
        timestamp = datetime.now().strftime('%Y%m%d_%H%M%S')
        backup_file = f"{database}_{timestamp}.sql"
        backup_path = os.path.join(output_dir, backup_file)
        
        # Create mysqldump command
        cmd = [
            'mysqldump',
            f'--host={self.config["host"]}',
            f'--port={self.config["port"]}',
            f'--user={self.config["user"]}',
            f'--password={self.config["password"]}',
            '--single-transaction',
            '--routines',
            '--triggers',
            '--events',
            database
        ]
        
        try:
            # Execute backup
            with open(backup_path, 'w') as f:
                result = subprocess.run(cmd, stdout=f, stderr=subprocess.PIPE, text=True)
            
            if result.returncode != 0:
                raise Exception(f"Backup failed: {result.stderr}")
            
            # Compress backup
            compressed_file = f"{backup_path}.gz"
            with open(backup_path, 'rb') as f_in:
                with gzip.open(compressed_file, 'wb') as f_out:
                    f_out.writelines(f_in)
            
            # Remove uncompressed file
            os.remove(backup_path)
            
            # Upload to S3
            self.upload_to_s3(compressed_file, f"backups/{database}/{os.path.basename(compressed_file)}")
            
            # Clean up local file
            os.remove(compressed_file)
            
            return {
                'status': 'success',
                'file': compressed_file,
                'size': os.path.getsize(compressed_file)
            }
            
        except Exception as e:
            self.logger.error(f"Backup failed: {e}")
            return {'status': 'failed', 'error': str(e)}</code></pre>
                        
                        <h3>3. Performance Monitoring</h3>
                        
                        <h4>Query Performance Analyzer</h4>
                        
                        <pre><code>import pandas as pd
from sqlalchemy import create_engine, text
import matplotlib.pyplot as plt
import seaborn as sns

class QueryPerformanceAnalyzer:
    def __init__(self, connection_string):
        self.engine = create_engine(connection_string)
    
    def analyze_slow_queries(self, hours=24):
        query = """
        SELECT 
            query_time,
            lock_time,
            rows_sent,
            rows_examined,
            db,
            sql_text,
            user_host,
            start_time
        FROM mysql.slow_log 
        WHERE start_time >= DATE_SUB(NOW(), INTERVAL %s HOUR)
        ORDER BY query_time DESC
        LIMIT 100
        """
        
        with self.engine.connect() as conn:
            df = pd.read_sql(query, conn, params=[hours])
        
        return df</code></pre>
                        
                        <h2>Automation Best Practices</h2>
                        
                        <h3>1. Error Handling</h3>
                        
                        <pre><code>import logging
from functools import wraps

def retry_on_failure(max_retries=3, delay=1):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except Exception as e:
                    if attempt == max_retries - 1:
                        logging.error(f"Function {func.__name__} failed after {max_retries} attempts: {e}")
                        raise
                    logging.warning(f"Attempt {attempt + 1} failed: {e}. Retrying...")
                    time.sleep(delay * (2 ** attempt))  # Exponential backoff
            return None
        return wrapper
    return decorator</code></pre>
                        
                        <h3>2. Configuration Management</h3>
                        
                        <pre><code>import yaml
from dataclasses import dataclass
from typing import Dict, List

@dataclass
class DatabaseConfig:
    host: str
    port: int
    user: str
    password: str
    database: str
    ssl_mode: str = 'prefer'

class ConfigManager:
    def __init__(self, config_file):
        with open(config_file, 'r') as f:
            self.config = yaml.safe_load(f)
    
    def get_database_config(self, env='production') -> DatabaseConfig:
        db_config = self.config['databases'][env]
        return DatabaseConfig(**db_config)
    
    def get_automation_config(self) -> Dict:
        return self.config['automation']</code></pre>
                        
                        <h2>Conclusion</h2>
                        <p>Database automation with Python provides powerful capabilities for maintaining reliable, scalable systems. The key is to start small, focus on the most critical operations, and gradually expand your automation coverage.</p>
                        
                        <p>Remember:</p>
                        <ul>
                            <li><strong>Test thoroughly</strong> before deploying to production</li>
                            <li><strong>Monitor everything</strong> and set up appropriate alerts</li>
                            <li><strong>Document your automation</strong> for team knowledge sharing</li>
                            <li><strong>Keep it simple</strong> - complexity is the enemy of reliability</li>
                        </ul>
                        
                        <hr>
                        <p><em>Published on December 5, 2024</em></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../script.js"></script>
</body>
</html>
